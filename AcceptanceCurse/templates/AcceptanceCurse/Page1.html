{% extends "global/Page.html" %}
{% load staticfiles otree %}

{% block title %}
    Round {{subsession.round_number}}
{% endblock %}

{% block content %}
    <hr>
    <h4 align="center"> In this round you will play Game {{ subsession.game }} </h4>
    <div class = "row">
        <div class="column">
            <p align="center">
                Points if you form a partnership:
            </p>
            <table class="tablex" align="center">
                <tr>
                    <td>Your Partner's Type</td>
                    <td>H</td>
                    <td>M</td>
                    <td>L</td>
                </tr>
                <tr>
                    <td>Your Points</td>
                    <td>160</td>
                    <td>80</td>
                    <td>40</td>
                </tr>
            </table>
            <br>
            <p align="center">
                Points if you do not form a partnership:
            </p>
            <table class="tablex" align="center">
                <tr>
                    <td>Your Type</td>
                    <td>H</td>
                    <td>M</td>
                    <td>L</td>
                </tr>
                <tr>
                    <td>Your Points</td>
                    <td>{% if subsession.game == "A" %} 100 {% elif subsession.game == "B" %} 80 {% endif %}</td>
                    <td>75</td>
                    <td>25</td>
                </tr>
            </table>
        </div>
        <div class="column">
            <p align="center">
                Distribution of Clues:
            </p>
            <figure align="center"><img src="{% static "AcceptanceCurse/urns.png" %}" width="80%" height="80%"/></figure>
        </div>
    </div>

    <hr>

    <h4 align="center"> Make a choice </h4>

    {% if player.type == 1 %}
    <p>
        You are an H type (your reservation value is: {% if subsession.game == "A" %} 100 {% elif subsession.game == "B" %} 80 {% endif %}).
    </p>
    {% elif player.type == 2 %}
    <p>
        You are an M type (your reservation value is: 75).
    </p>
    {% elif player.type == 3 %}
    <p>
        You are an L type (your reservation value is: 25).
    </p>
    {% endif %}

    {% if player.signal == 1 %}
    <p>
        You have received a <font color="red"> red </font> clue.
    </p>
    {% elif player.signal == 2 %}
    <p>
        You have received a <font color="gold"> yellow </font> clue.
    </p>
    {% elif player.signal == 3 %}
    <p>
        You have received a <font color="blue"> blue </font> clue.
    </p>
    {% endif %}

    <p>
        Choose if you want to propose to form a partnership with the other player or not.
    </p>

    {% formfield player.choice label="I choose:" %}
    {% next_button %}
    <br />
    <br />
    <br />
    <h4>History Table</h4>
    <table class="tablex">
        <tr>
            <th>Round</th>
            <th>Game</th>
            <th>Your Type</th>
            <th>Your Reservation Value</th>
            <th>Your Clue</th>
            <th>Your Choice</th>
            <th>Partner's Choice</th>
            <th>Partner's Type</th>
            <th>Your points</th>
        </tr>
        {% for p in player.in_all_rounds %}
            <tr>
                <td>{{ p.subsession.round_number }}</td>
                <td>{{ p.subsession.game }} </td>
                <td>{% if p.type == 1 %} H {% elif p.type == 2 %} M {% elif p.type == 3 %} L {% endif %}</td>
                <td>{% if p.type == 1 %} {% if subsession.game == "A" %} 100 {% elif subsession.game == "B" %} 80 {% endif %} {% elif p.type == 2 %} 75 {% elif p.type == 3 %} 25 {% endif %}</td>
                <td>{% if p.signal == 1 %} Red {% elif p.signal == 2 %} Yellow {% elif p.signal == 3 %} Blue {% endif %}</td>
                <td>{% if p.round_number == player.round_number %} - {% elif p.choice %} Propose {% else %} Don't Propose {% endif %}</td>
                <td>{% if p.round_number == player.round_number %} - {% elif p.partner_choice %} Propose {% else %} Don't Propose {% endif %}</td>
                <td>{% if p.round_number == player.round_number %} - {% elif p.partner_type == 1 %} H {% elif p.partner_type == 2 %} M {% elif p.partner_type == 3 %} L {% endif %}</td>
                <td>{% if p.round_number == player.round_number %} - {% else %} {{p.points}} {% endif %}</td>
            </tr>
        {% endfor %}
    </table>

{% endblock %}

{% block styles %}
    <style>
        .otree-timer {
            display: none;
        }
        .column {
            float: left;
            width: 50%;
            padding: 5px;
        }
        .row::after {
            content: "";
            clear: both;
            display: table;
        }
        tablex, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 5px;
            text-align: center;
        }
    </style>

{% endblock %}

{% block scripts %}
    <script>
        $(function () {
            $('.otree-timer__time-left').on('update.countdown', function (event) {
                if (event.offset.totalSeconds === 5) {
                    $('.otree-timer').show();
                }
            });
        });
    </script>
{% endblock %}

